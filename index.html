<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Sol Mini Game</title>

  <style>
    body {
      margin: 0;
      height: 100vh;
      background: #0b0f19;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .box {
      background: #151a2d;
      padding: 24px;
      border-radius: 12px;
      text-align: center;
      width: 260px;
    }

    button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      background: #6c5ce7;
      border: none;
      border-radius: 8px;
      color: #fff;
      font-size: 16px;
    }

    .msg {
      margin-top: 15px;
      font-size: 14px;
      word-break: break-all;
    }
  </style>
</head>

<body>
  <div class="box">
    <h2>üéÆ Sol Mini Game</h2>

    <button onclick="connect()">Connect Phantom</button>
    <button onclick="play()">Play (0.001 SOL)</button>

    <div class="msg" id="msg"></div>
  </div>

  <!-- Solana Web3 -->
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>

  <script>
    const {
      Connection,
      PublicKey,
      Transaction,
      SystemProgram,
      LAMPORTS_PER_SOL
    } = solanaWeb3;

    // üî¥ ƒê·ªîI V√ç N√ÄY TH√ÄNH V√ç C·ª¶A B·∫†N
    const GAME_WALLET = new PublicKey(
      "Dz73z9YtS5F6DwN8U3wuhHYGi2DiTjavvNbTcVTau3W6"
    );

    const connection = new Connection(
      "https://api.devnet.solana.com",
      "confirmed"
    );

    let wallet = null;

    function msg(t) {
      document.getElementById("msg").innerText = t;
    }

    // CONNECT PHANTOM
    async function connect() {
      if (!window.solana || !window.solana.isPhantom) {
        alert("C√†i Phantom tr∆∞·ªõc");
        return;
      }

      const res = await window.solana.connect();
      wallet = res;
      msg("ƒê√£ k·∫øt n·ªëi:\n" + wallet.publicKey.toString());
    }

    // PLAY GAME ‚Äì FIX ƒê·∫¶Y ƒê·ª¶
    async function play() {
      if (!wallet) {
        alert("Ch∆∞a connect v√≠");
        return;
      }

      const tx = new Transaction().add(
        SystemProgram.transfer({
          fromPubkey: wallet.publicKey,
          toPubkey: GAME_WALLET,
          lamports: Math.floor(0.001 * LAMPORTS_PER_SOL),
        })
      );

      // üî• B·∫ÆT BU·ªòC ‚Äì n·∫øu thi·∫øu Phantom s·∫Ω KH√îNG hi·ªán
      tx.feePayer = wallet.publicKey;
      const { blockhash } = await connection.getLatestBlockhash();
      tx.recentBlockhash = blockhash;

      // üëâ PHANTOM POPUP ·ªû ƒê√ÇY
      const signedTx = await window.solana.signTransaction(tx);
      const sig = await connection.sendRawTransaction(
        signedTx.serialize()
      );
      await connection.confirmTransaction(sig);

      const win = Math.random() < 0.5;
      msg(win ? "üéâ YOU WIN" : "‚ùå YOU LOSE");
    }
  </script>
</body>
</html>
